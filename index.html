<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0" />
		<title></title>
		<link rel="stylesheet" href="css/reset.css" />
		<link rel="stylesheet" href="css/main.css" />
		<style>
			.m-artical-action-mid{
				position: fixed;
				width: 100%;
				height: 40%;
				top: 30%;
				z-index: 9998;
			}
		</style>
	</head>
	<body>
		<!--中间点击层-->
		<div class="m-artical-action">
			<div class="m-artical-action-mid" id="action_mid"></div>
		</div>
		<!--顶部导航-->
		<div class="nav-top" id="nav_top" style="display: none;">
			<div class="nav_container">
				<div class="nav_return"></div>
				<div class="nav_text">返回书架</div>
			</div>
		</div>
		<!--主体内容-->
		<div class="container">
			<div class="Content">
				<h4 class="Title">第004章 绝处缝生</h4>
				<p>从朱莉家出来后，盛夏在招待所将就了一夜。闺蜜小雅想让盛夏住她家去，但盛夏没同意。</p>
				<p>小雅和她男朋友挤在一个二十多平的一室户里，就算能挪出地方来给她，两个女的，一个男的，也太不方便。</p>
				<p>这家超市是西林本土的一家小型连锁店。店面铺得广，员工又多，提供住的地方，所以工资不高。</p>
				<p>盛夏以前也想过要住超市宿舍。可是……就一个一百平的仓库，还要隔开男女宿舍，洗澡间，卫生间，厨房，饭厅。四个女工，七个男工挤在一处。</p>
				<p>这种地方，人多，又杂又乱，她一个刚毕业的小女生，很不安全。何况，店里的主管是个出了名的老色鬼。以往就对几个女工动过坏心思。之前不在这里住，没觉得有多大不了。但是现在，朝夕见面，他时不时调戏刁难，就觉得难堪了许多。</p>
				<p>这种地方，人多，又杂又乱，她一个刚毕业的小女生，很不安全。何况，店里的主管是个出了名的老色鬼。以往就对几个女工动过坏心思。之前不在这里住，没觉得有多大不了。但是现在，朝夕见面，他时不时调戏刁难，就觉得难堪了许多。</p>
				<p>这种地方，人多，又杂又乱，她一个刚毕业的小女生，很不安全。何况，店里的主管是个出了名的老色鬼。以往就对几个女工动过坏心思。之前不在这里住，没觉得有多大不了。但是现在，朝夕见面，他时不时调戏刁难，就觉得难堪了许多。</p>
				<p>这种地方，人多，又杂又乱，她一个刚毕业的小女生，很不安全。何况，店里的主管是个出了名的老色鬼。以往就对几个女工动过坏心思。之前不在这里住，没觉得有多大不了。但是现在，朝夕见面，他时不时调戏刁难，就觉得难堪了许多。</p>
				<div class="page_btn">
					<button class="btn_prev">上一页</button>
					<button class="btn_next">下一页</button>
				</div>
			</div>
		</div>

		<!--底部导航栏    -->
		<div class="nav-bottom" id="nav_bottom" style="display: none;">
			<div class="btn-mulu">
				<div class="mulu">
					<div class="icon_mulu"> </div>
					<div class="text_mulu">目录</div>
				</div>
			</div>
			<div class="btn_Aa">
				<div class="Aa">
					<div class="icon-Aa" id="icon_Aa"> </div>
				<div class="text_Aa">字体</div>
				</div>
			</div>
			<div class="btn-yejian">
				<div class="yejian">
					<div class="icon-yejian" id="icon_yejian"> </div>
					<div class="text_yejian">夜间</div>
				</div>
			</div>
			
			<!--字体功能栏-->
		<div class="fontPop" id="font_Pop" style="display: none;">
			<div class="fontSize">
				<span>字号</span>
				<button class="btnBig" id="btn_Big">大</button>
				<button class="btnSmall" id="btn_Small">小</button>
			</div>
			<div class="fontBk">
				<span>背景</span>
				<div class="bkColor">
					<div class="bk-container" style="background-color: #f7eee5;">
						<div id="mb"><span >	米白	</span></div>
					</div>
					<div class="bk-container" style="background-color: #e9dfc7;">
						<div id="zz"><span >	纸张	</span></div>
					</div>
					<div class="bk-container" style="background-color: #a4a4a4;">
						<div id="qh"><span >	浅灰	</span></div>
					</div>
					<div class="bk-container" style="background-color: #cdefce;">
						<div id="hy"><span >	护眼	</span></div>
					</div>
					<div class="bk-container" style="background-color: #283548;">
						<div id="hl"><span >	海蓝	</span></div>
					</div>
				</div>
			</div>
		</div>
		</div>
		
		<script type="text/javascript" src="js/jquery.min.js" ></script>
		<script type="text/javascript" src="js/jquery.jsonp.js" ></script>
		<script type="text/javascript" src="js/jquery.base64.js" ></script>
		<script>
		$(document).ready(function(){
			
			var readerm=ReaderModel();
			readerm.init();
			EventHandler();
			
		});
		var Util=(function(){
				var prefix = 'function_reader_';
				var StorageGetter = function(key){
					return localStorage.getItem(prefix + key);
				}
				var StorageSetter = function(key,val){
					return localStorage.setItem(prefix+key,val);
				}
				//通过url来获取加密信息，并解密
				var getJsonp=function(url,callback){
					return $.jsonp({
						url:url,
						cache:true,
						callback:'duokan_fiction_chapter',
						success:function(result){
							//获取加密信息，解码、转json
							debugger;
							var data=$.base64.decode(result);
							var json=decodeURIComponent(escape(data));
							callback(json);
						}
					})
				}
				
				return{
					getJsonp:getJsonp,
					StorageGetter:StorageGetter,
					StorageSetter:StorageSetter
				}
			})();
			var Dom={
					font_Pop: $("#font_Pop"),
					nav_top:$("#nav_top"),
					nav_bottom:$("#nav_bottom"),
					icon_Aa:$("#icon_Aa"),
					body:$("body"),
					win:$(window),
					icon_yejian:$("#icon_yejian"),
					btn_Big:$("#btn_Big"),
					btn_Small:$("#btn_Small")
			}
		//背景颜色
		var bkgroundcolor=Util.StorageGetter("bkgroundcolor");
		var bkCurrColor=Util.StorageGetter("bkgroundcolor");
		Dom.body.css('background-color',bkgroundcolor);
		//字号大小 设置
		var InitFontSize;
		InitFontSize=Util.StorageGetter("font_size");
		InitFontSize= parseInt(InitFontSize);
		if (!InitFontSize) {
				InitFontSize = 18;
			}
		$("p").css('font-size',InitFontSize);
		
		function ReaderModel(){//数据交互层
			//todo 获取章节信息
			var Chapter_id;
			var init=function(){//初始化 信息
				getFictionInfo(function(){
					getCurChaptInfo(Chapter_id,function(){
						//todo 
						
					})
				})
			}
			var getFictionInfo=function(callback){
				$.get('data/chapter.json',function(data){
					//todo 获取章节信息之后的回调
					Chapter_id=data.chapters[1].chapter_id;
					callback&&callback();
				},'json');
			}
			var getCurChaptInfo=function(Chapter_id,data,callback){
				$.get('data/data'+Chapter_id+'.json',function(data){
					//todo 获取详细信息之后的回调
					if(data.result == 0){
						var url=data.jsonp;//jsonp URL
						Util.getJsonp(url,function(data){
							callback && callback(data);
						});//通过url来获取加密信息，并解密
					}
				},'json');
			}
			return{
				init:init
			}
		}
		
		function EventHandler(){//业务事件处理层
			//点击主体中间事件
			$("#action_mid").click(function(){
				if(Dom.nav_top.css('display')=="none"){
					Dom.nav_top.show();
					Dom.nav_bottom.show();
				}else{
					Dom.nav_top.hide();
					Dom.nav_bottom.hide();
					Dom.font_Pop.hide();
					Dom.icon_Aa.css('border','');
					Dom.icon_yejian.css('border','');
				}
			});
			//点击字体事件
			$(".btn_Aa").click(function(){
				if (Dom.font_Pop.css('display') == 'none') {
					Dom.icon_Aa.css('border','1px solid #FF7800');
					Dom.font_Pop.show();
				} else{
					Dom.icon_Aa.css('border','');
					Dom.font_Pop.hide();
				}
			});
			//点击夜间事件
			$(".btn-yejian").click(function(){
				if (Dom.body.css('background-color')!="rgb(40, 53, 72)") {
					bkCurrColor='#283548';
					//$(".bkColor").find('.bk-container-current')[0].className='';
					Dom.body.css('background-color',bkCurrColor);
					Dom.icon_yejian.css('border','1px #FF7800 solid');
					$("#hl").addClass('bk-container-current');
					
				} else{
					bkCurrColor='#e9dfc7';
					Dom.body.css('background-color',bkCurrColor);
					Dom.icon_yejian.css('border','');
					$("#hl").removeClass('bk-container-current');
					$("#mb").addClass('bk-container-current');
				}
				Util.StorageSetter("bkgroundcolor",bkCurrColor);
			});
			//滚动条事件
			Dom.win.scroll(function(){
				Dom.nav_top.hide();
				Dom.nav_bottom.hide();
				Dom.font_Pop.hide();
				Dom.icon_Aa.css('border','');
				Dom.icon_yejian.css('border','');
			})
			//点击 大、小事件
			Dom.btn_Big.click(function(){
				if(InitFontSize>=20){
					return;
				}
				InitFontSize+=1;
				console.log(InitFontSize);
				$("p").css('font-size',InitFontSize);
				Util.StorageSetter("font_size",InitFontSize);
			});
			Dom.btn_Small.click(function(){
				if(InitFontSize<=12){
					return;
				}
				InitFontSize-=1;
				console.log(InitFontSize);
				$("p").css('font-size',InitFontSize);
				Util.StorageSetter("font_size",InitFontSize);
			});
			//点击背景颜色切换
			$(".bk-container").bind('click',function(){
				if ($(".bkColor").find('.bk-container-current').length>0) {
					$(".bkColor").find('.bk-container-current')[0].className='';
				} else{
					
				}
				var id= this.firstElementChild.id;
				$("#"+id).addClass('bk-container-current');
				
				switch (id){
					case 'mb':
					Dom.body.css('background-color','#f7eee5');
						break;
						case 'zz':
					Dom.body.css('background-color','#e9dfc7');
						break;
						case 'qh':
					Dom.body.css('background-color','#a4a4a4');
						break;
						case 'hy':
					Dom.body.css('background-color','#cdefce');
						break;
						case 'hl':
					Dom.body.css('background-color','#283548');
						break;
					default:
						break;
				}
			Util.StorageSetter("bkgroundcolor",Dom.body.css('background-color'));
			});
		}
		</script>
	</body>

</html>